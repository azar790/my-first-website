<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Kredit Kalkulyatoru</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold text-center mb-6 text-indigo-600">Kredit Kalkulyatoru</h1>

    <!-- Inputlar -->
    <div class="grid md:grid-cols-3 gap-4 mb-4">
      <div>
        <label class="text-sm">Kredit Məbləği (₼)</label>
        <input id="loanAmount" type="number" class="w-full p-2 border rounded" placeholder="Məbləğ" />
      </div>
      <div>
        <label class="text-sm">Faiz Dərəcəsi (%)</label>
        <input id="interestRate" type="number" class="w-full p-2 border rounded" placeholder="Faiz" step="0.01" />
      </div>
      <div>
        <label class="text-sm">Müddət (ay)</label>
        <input id="loanTerm" type="number" class="w-full p-2 border rounded" placeholder="Ay" />
      </div>
    </div>

    <!-- Əlavə Ödəniş -->
    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <div>
        <label class="text-sm">Əlavə Ödəniş Aylıq Məbləği (₼)</label>
        <input id="extraAmount" type="number" class="w-full p-2 border rounded" placeholder="Məbləğ" />
      </div>
      <div>
        <label class="text-sm">Başlanğıc Ay</label>
        <input id="extraStart" type="number" class="w-full p-2 border rounded" placeholder="məs: 13" />
      </div>
      <div>
        <label class="text-sm">Son Ay</label>
        <input id="extraEnd" type="number" class="w-full p-2 border rounded" placeholder="məs: 18" />
      </div>
    </div>

    <!-- Option to Choose -->
    <div class="mb-4">
      <label class="text-sm">Ödəniş Termini Azalt (və ya) Aylıq Ödənişi Azalt</label>
      <div class="flex items-center">
        <input type="radio" id="reduceTerm" name="paymentOption" value="reduceTerm" checked class="mr-2" />
        <label for="reduceTerm" class="text-sm mr-4">Ödəniş Termini Azalt</label>
        
        <input type="radio" id="reducePayment" name="paymentOption" value="reducePayment" class="mr-2" />
        <label for="reducePayment" class="text-sm">Aylıq Ödənişi Azalt</label>
      </div>
    </div>

    <button onclick="calculateLoan()" class="bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 w-full mb-6">
      Hesabla
    </button>

    <!-- Nəticələr -->
    <div id="results" class="hidden">
      <div class="grid md:grid-cols-4 gap-4 text-center mb-4">
        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm">Standart Aylıq Ödəniş</p>
          <p id="monthly" class="text-xl font-bold text-indigo-700">₼0.00</p>
        </div>
        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm">Əvvəlki Ümumi Faiz</p>
          <p id="originalInterest" class="text-xl font-bold text-red-500">₼0.00</p>
        </div>
        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm">Yeni Ümumi Faiz</p>
          <p id="newInterest" class="text-xl font-bold text-green-600">₼0.00</p>
        </div>
        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm">Qənaət (Faiz)</p>
          <p id="savedInterest" class="text-xl font-bold text-blue-600">₼0.00</p>
        </div>
      </div>

      <div class="text-center mb-6">
        <p class="font-medium text-gray-700">Yeni Müddət: <span id="newMonths" class="text-indigo-700 font-semibold">0</span> ay</p>
        <p class="font-medium text-gray-700">Yeni Aylıq Ödəniş: <span id="newMonthlyPayment" class="text-indigo-700 font-semibold">₼0.00</span></p>
      </div>

      <!-- Cədvəl -->
      <h2 class="text-lg font-semibold mb-2">Aylıq Cədvəl</h2>
      <div class="overflow-auto max-h-[500px] border rounded">
        <table class="w-full text-sm text-left">
          <thead class="bg-gray-200 sticky top-0">
            <tr>
              <th class="p-2 border">Ay</th>
              <th class="p-2 border">Ödəniş (₼)</th>
              <th class="p-2 border">Əsas (₼)</th>
              <th class="p-2 border">Faiz (₼)</th>
              <th class="p-2 border">Qalıq Borc (₼)</th>
            </tr>
          </thead>
          <tbody id="schedule" class="bg-white divide-y"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    function calculateLoan() {
      // Get input values
      const loanAmountInput = document.getElementById('loanAmount').value;
      const interestRateInput = document.getElementById('interestRate').value;
      const loanTermInput = document.getElementById('loanTerm').value;
      const extraAmountInput = document.getElementById('extraAmount').value;
      const extraStartInput = document.getElementById('extraStart').value;
      const extraEndInput = document.getElementById('extraEnd').value;
      
      // Validate required inputs
      if (!loanAmountInput || !interestRateInput || !loanTermInput) {
        alert("Zəhmət olmasa, kredit məbləği, faiz dərəcəsi və kredit müddətini daxil edin.");
        return;
      }
      
      const P = parseFloat(loanAmountInput);
      const annualRate = parseFloat(interestRateInput);
      const n = parseInt(loanTermInput);
      const r = annualRate / 100 / 12;
      const M = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
      
      const extraAmount = extraAmountInput ? parseFloat(extraAmountInput) : 0;
      const extraStart = extraStartInput ? parseInt(extraStartInput) : 0;
      const extraEnd = extraEndInput ? parseInt(extraEndInput) : 0;

      // Get the selected option
      const reduceTerm = document.getElementById('reduceTerm').checked;
      
      // Original loan stats
      const originalInterest = M * n - P;
      document.getElementById('monthly').textContent = `₼${M.toFixed(2)}`;
      document.getElementById('originalInterest').textContent = `₼${originalInterest.toFixed(2)}`;
      
      // Calculate loan depending on option
      if (reduceTerm) {
        // Option 1: Reduce loan term
        calculateReducedTerm(P, r, n, M, extraAmount, extraStart, extraEnd);
      } else {
        // Option 2: Reduce monthly payment
        calculateReducedPayment(P, r, n, M, extraAmount, extraStart, extraEnd);
      }

      document.getElementById('results').classList.remove('hidden');
    }
    
    function calculateReducedTerm(principal, rate, term, monthlyPayment, extraAmount, extraStart, extraEnd) {
      let balance = principal;
      let month = 0;
      let schedule = "";
      let newInterest = 0;
      let totalPaid = 0;
      
      // Continue payments until balance is paid off
      while (balance > 0.01) {
        month++;
        let payment;
        
        // Use extra payment amount if within range, otherwise use regular monthly payment
        if (extraAmount > 0 && month >= extraStart && month <= extraEnd) {
          payment = extraAmount;
        } else {
          payment = monthlyPayment;
        }
        
        const interestPayment = balance * rate;
        let principalPayment = payment - interestPayment;
        
        // Adjust for final payment
        if (principalPayment > balance) {
          principalPayment = balance;
          payment = principalPayment + interestPayment;
        }
        
        balance -= principalPayment;
        totalPaid += payment;
        newInterest += interestPayment;
        
        schedule += `
          <tr>
            <td class="p-2 border">${month}</td>
            <td class="p-2 border">₼${payment.toFixed(2)}</td>
            <td class="p-2 border">₼${principalPayment.toFixed(2)}</td>
            <td class="p-2 border">₼${interestPayment.toFixed(2)}</td>
            <td class="p-2 border">₼${Math.max(0, balance).toFixed(2)}</td>
          </tr>`;
      }
      
      // Update results
      const savedInterest = (monthlyPayment * term - principal) - newInterest;
      document.getElementById('newInterest').textContent = `₼${newInterest.toFixed(2)}`;
      document.getElementById('savedInterest').textContent = `₼${savedInterest.toFixed(2)}`;
      document.getElementById('newMonths').textContent = month;
      document.getElementById('newMonthlyPayment').textContent = `₼${monthlyPayment.toFixed(2)}`;
      document.getElementById('schedule').innerHTML = schedule;
    }
    
    function calculateReducedPayment(principal, rate, term, originalMonthly, extraAmount, extraStart, extraEnd) {
      let balance = principal;
      let month = 0;
      let schedule = "";
      let newInterest = 0;
      let totalPaid = 0;
      let newMonthlyPayment = originalMonthly;
      const originalTerm = term;
      
      // Process the initial payment period including extra payments
      while (month < extraEnd && balance > 0.01) {
        month++;
        let payment;
        
        // Use extra payment amount if within range, otherwise use regular monthly payment
        if (extraAmount > 0 && month >= extraStart && month <= extraEnd) {
          payment = extraAmount;
        } else {
          payment = originalMonthly;
        }
        
        const interestPayment = balance * rate;
        let principalPayment = payment - interestPayment;
        
        // Adjust for final payment
        if (principalPayment > balance) {
          principalPayment = balance;
          payment = principalPayment + interestPayment;
        }
        
        balance -= principalPayment;
        totalPaid += payment;
        newInterest += interestPayment;
        
        schedule += `
          <tr>
            <td class="p-2 border">${month}</td>
            <td class="p-2 border">₼${payment.toFixed(2)}</td>
            <td class="p-2 border">₼${principalPayment.toFixed(2)}</td>
            <td class="p-2 border">₼${interestPayment.toFixed(2)}</td>
            <td class="p-2 border">₼${Math.max(0, balance).toFixed(2)}</td>
          </tr>`;
      }
      
      // Recalculate monthly payment for remaining balance over remaining term
      if (balance > 0.01) {
        const remainingMonths = originalTerm - month;
        if (remainingMonths > 0) {
          newMonthlyPayment = (balance * rate * Math.pow(1 + rate, remainingMonths)) / 
                            (Math.pow(1 + rate, remainingMonths) - 1);
                            
          // Continue with new monthly payment
          while (balance > 0.01 && month < originalTerm) {
            month++;
            let payment = newMonthlyPayment;
            
            const interestPayment = balance * rate;
            let principalPayment = payment - interestPayment;
            
            // Adjust for final payment
            if (principalPayment > balance) {
              principalPayment = balance;
              payment = principalPayment + interestPayment;
            }
            
            balance -= principalPayment;
            totalPaid += payment;
            newInterest += interestPayment;
            
            schedule += `
              <tr>
                <td class="p-2 border">${month}</td>
                <td class="p-2 border">₼${payment.toFixed(2)}</td>
                <td class="p-2 border">₼${principalPayment.toFixed(2)}</td>
                <td class="p-2 border">₼${interestPayment.toFixed(2)}</td>
                <td class="p-2 border">₼${Math.max(0, balance).toFixed(2)}</td>
              </tr>`;
          }
        }
      }
      
      // Update results
      const savedInterest = (originalMonthly * originalTerm - principal) - newInterest;
      document.getElementById('newInterest').textContent = `₼${newInterest.toFixed(2)}`;
      document.getElementById('savedInterest').textContent = `₼${savedInterest.toFixed(2)}`;
      document.getElementById('newMonths').textContent = month;
      document.getElementById('newMonthlyPayment').textContent = `₼${newMonthlyPayment.toFixed(2)}`;
      document.getElementById('schedule').innerHTML = schedule;
    }
  </script>
</body>
</html>
